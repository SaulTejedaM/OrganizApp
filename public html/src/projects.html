<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projects</title>
  <!-- BOOSTRAP CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css">
  <!-- Toastify CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="home.html">OrganizApp</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ms-auto">
          <a class="nav-link logged-in" href="#">Profile</a>
          <a class="nav-link logged-in" href="projects.html">Projects</a>
          <a class="nav-link logged-in" href="#">Teammates</a>
          <a class="nav-link logged-in" href="#">Settings</a>
          <a class="nav-link logged-in" href="#" id="logout">Logout</a>
        </div>
      </div>
    </div>
  </nav>
  
  <div class="nav-link logged-in">
  <center>  
    <br>
    <h1>Projects</h1>
    <br>
  </center>
  <div style="align-content: right; padding: 0% 15%;">     
    <button type="button" class="btn btn-success rounded-pill px-4" onclick="window.location.href='new_project.html'">New Project</button>
  </div>
  <br>
  <h2>Your projects:</h2>
  <ol id="project-list"></ol>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
  <script>
    function getProjects() {
  projectRef.on('value', function(snapshot) {
    const proyectos = snapshot.val();
    const projectList = document.getElementById('project-list');
    projectList.innerHTML = '';
    for (let proyecto in proyectos) {
      const projectItem = document.createElement('li');
      const jsonObj = JSON.parse(proyectos[proyecto]);
      const id = jsonObj.data[0].id;
      const startDate = jsonObj.data[0].start_date;
      const project_name = jsonObj.data[0].text;
      const firstTask = project_name;
      projectItem.innerHTML = id + firstTask + startDate;
      projectList.appendChild(projectItem);
    }
  });
}
    function get_uid() {
      var name = "uid=";
      var decoded_cookie = decodeURIComponent(document.cookie);
      var cookie_array = decoded_cookie.split(';');
      for(var i = 0; i < cookie_array.length; i++) {
        var cookie = cookie_array[i];
        while (cookie.charAt(0) == ' ') {
          cookie = cookie.substring(1);
        }
        if (cookie.indexOf(name) == 0) {
          return cookie.substring(name.length, cookie.length);
        }
      }
      return "";
    }
    const firebaseConfig = {
      apiKey: "AIzaSyD5e7ZJ4IJlxUOezr7SyGWxeIE2fe_jWuY",
      authDomain: "organizapp-6c914.firebaseapp.com",
      projectId: "organizapp-6c914",
      storageBucket: "organizapp-6c914.appspot.com",
      messagingSenderId: "447288139021",
      appId: "1:447288139021:web:a72ec9d1a44319972da444"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const userID = get_uid();
    const projectRef = database.ref('proyectos/'+userID);
    getProjects();
  </script>
</div>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Toastify js -->

</body>

</html>